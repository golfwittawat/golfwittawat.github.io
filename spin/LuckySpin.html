<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FF9E99">
    <meta name="description" content="‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏à‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="LuckySpin">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.svg">
    <title>üéÅ LuckySpin 2025 üéâ</title>
    <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Reset & Base */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-family: 'Mali', sans-serif;
        }

        body {
            color: #374151;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
            background: linear-gradient(135deg, #FFDAC1 0%, #FFB7B2 25%, #E2F0CB 50%, #B5EAD7 75%, #C7CEEA 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .fixed {
            position: fixed;
        }

        .absolute {
            position: absolute;
        }

        .relative {
            position: relative;
        }

        .inset-0 {
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        .z-10 {
            z-index: 10;
        }

        .z-20 {
            z-index: 20;
        }

        .z-40 {
            z-index: 40;
        }

        .z-50 {
            z-index: 50;
        }

        .z-100 {
            z-index: 100;
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-center {
            justify-content: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .gap-3 {
            gap: 0.75rem;
        }

        .gap-4 {
            gap: 1rem;
        }

        .w-full {
            width: 100%;
        }

        .h-full {
            height: 100%;
        }

        .m-auto {
            margin: auto;
        }

        .p-4 {
            padding: 1rem;
        }

        .p-3 {
            padding: 0.75rem;
        }

        .p-8 {
            padding: 2rem;
        }

        .px-3 {
            padding-left: 0.75rem;
            padding-right: 0.75rem;
        }

        .px-6 {
            padding-left: 1.5rem;
            padding-right: 1.5rem;
        }

        .py-1 {
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
        }

        .py-2 {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }

        .py-3 {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
        }

        .py-4 {
            padding-top: 1rem;
            padding-bottom: 1rem;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mb-8 {
            margin-bottom: 2rem;
        }

        .mt-3 {
            margin-top: 0.75rem;
        }

        .my-4 {
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .text-xs {
            font-size: 0.75rem;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .text-lg {
            font-size: 1.125rem;
        }

        .text-xl {
            font-size: 1.25rem;
        }

        .text-2xl {
            font-size: 1.5rem;
        }

        .text-3xl {
            font-size: 1.875rem;
        }

        .text-6xl {
            font-size: 3.75rem;
        }

        .text-7xl {
            font-size: 4.5rem;
        }

        .font-bold {
            font-weight: 700;
        }

        .font-mono {
            font-family: monospace;
        }

        .uppercase {
            text-transform: uppercase;
        }

        .tracking-widest {
            letter-spacing: 0.1em;
        }

        .underline {
            text-decoration: underline;
        }

        .rounded-lg {
            border-radius: 0.5rem;
        }

        .rounded-xl {
            border-radius: 0.75rem;
        }

        .rounded-2xl {
            border-radius: 1rem;
        }

        .rounded-full {
            border-radius: 9999px;
        }

        .border-2 {
            border-width: 2px;
        }

        .border-4 {
            border-width: 4px;
        }

        .border-8 {
            border-width: 8px;
        }

        .border-white {
            border-color: white;
        }

        .bg-white {
            background-color: white;
        }

        .text-white {
            color: white;
        }

        .cursor-pointer {
            cursor: pointer;
        }

        .pointer-events-none {
            pointer-events: none;
        }

        .overflow-hidden {
            overflow: hidden;
        }

        .overflow-y-auto {
            overflow-y: auto;
        }

        .transition-all {
            transition: all 0.3s ease;
        }

        .transition-transform {
            transition: transform 0.3s ease;
        }

        .transition-opacity {
            transition: opacity 0.3s ease;
        }

        .duration-300 {
            transition-duration: 300ms;
        }

        .opacity-0 {
            opacity: 0;
        }

        .shadow-sm {
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .shadow-lg {
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .shadow-xl {
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
        }

        .shadow-2xl {
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .drop-shadow-sm {
            filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.05));
        }

        .drop-shadow-md {
            filter: drop-shadow(0 4px 3px rgba(0, 0, 0, 0.07));
        }

        /* Custom Colors */
        .text-gray-400 {
            color: #9CA3AF;
        }

        .text-gray-500 {
            color: #6B7280;
        }

        .text-gray-600 {
            color: #4B5563;
        }

        .text-red-400 {
            color: #F87171;
        }

        .text-red-500 {
            color: #EF4444;
        }

        .bg-pink {
            background-color: #FFB7B2;
        }

        .bg-pink-dark {
            background-color: #FF9E99;
        }

        .bg-purple {
            background-color: #C7CEEA;
        }

        .bg-purple-dark {
            background-color: #B5B9E8;
        }

        .bg-mint {
            background-color: #B5EAD7;
        }

        .bg-mint-dark {
            background-color: #9FDFC3;
        }

        .text-pink {
            color: #FF9E99;
        }

        .text-purple {
            color: #C7CEEA;
        }

        .border-pink {
            border-color: #FFB7B2;
        }

        .border-purple {
            border-color: #C7CEEA;
        }

        /* Glass Panel */
        .glass-panel {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(12px);
            border: 2px solid #FFF;
            box-shadow: 0 8px 32px 0 rgba(181, 234, 215, 0.4);
            border-radius: 24px;
            transition: all 0.3s ease;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #FFB7B2;
            border-radius: 4px;
        }

        /* Snowflakes */
        .shape {
            position: absolute;
            filter: blur(1px);
            z-index: 0;
            animation: fall linear infinite;
            opacity: 0.8;
            color: #FFF;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
            pointer-events: none;
            font-size: 1.5rem;
        }

        @keyframes fall {
            0% {
                transform: translateY(-10vh) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.8;
            }

            100% {
                transform: translateY(110vh) rotate(360deg);
                opacity: 0.4;
            }
        }

        /* Fade Out */
        .fade-out {
            opacity: 0 !important;
            pointer-events: none;
            transition: opacity 1s ease-out;
        }

        /* Pulse Animation */
        @keyframes pulse-soft {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 183, 178, 0.7);
            }

            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(255, 183, 178, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 183, 178, 0);
            }
        }

        .animate-pulse-soft {
            animation: pulse-soft 2s infinite;
        }

        /* Bounce */
        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-25%);
            }
        }

        .animate-bounce {
            animation: bounce 1s infinite;
        }

        /* Text Glow */
        .text-glow {
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8), 0 0 10px rgba(255, 183, 178, 0.5);
        }

        /* Popup Panel */
        .popup-panel {
            position: fixed;
            top: 70px;
            right: 16px;
            width: 320px;
            max-width: calc(100vw - 32px);
            z-index: 45;
            transform: translateX(120%);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .popup-panel.show {
            transform: translateX(0);
            opacity: 1;
        }

        /* Icon Button */
        .icon-btn {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border-radius: 50%;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .icon-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .icon-btn:active {
            transform: scale(0.95);
        }

        /* Input & Button */
        .input-field {
            width: 100%;
            background: white;
            border: 1px solid #FFB7B2;
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            text-align: center;
            font-weight: bold;
            color: #4B5563;
            outline: none;
        }

        .input-field:focus {
            box-shadow: 0 0 0 2px #FFB7B2;
        }

        .textarea-field {
            width: 100%;
            height: 128px;
            background: white;
            border: 1px solid #C7CEEA;
            border-radius: 0.75rem;
            padding: 0.75rem;
            font-size: 0.875rem;
            font-family: monospace;
            color: #4B5563;
            resize: none;
            outline: none;
        }

        .textarea-field:focus {
            box-shadow: 0 0 0 2px #C7CEEA;
        }

        .btn {
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-pink {
            background: #FFB7B2;
            color: white;
        }

        .btn-pink:hover {
            background: #FF9E99;
        }

        .btn-purple {
            background: #C7CEEA;
            color: white;
        }

        .btn-purple:hover {
            background: #B5B9E8;
        }

        .btn-mint {
            background: #B5EAD7;
            color: white;
        }

        .btn-mint:hover {
            background: #9FDFC3;
        }

        .btn-full {
            width: 100%;
            padding: 0.75rem;
        }

        .link-btn {
            font-size: 0.75rem;
            color: #F87171;
            text-decoration: underline;
            background: none;
            border: none;
            cursor: pointer;
        }

        .link-btn:hover {
            color: #EF4444;
        }

        .close-btn {
            color: #9CA3AF;
            font-size: 1.25rem;
            background: none;
            border: none;
            cursor: pointer;
        }

        .close-btn:hover {
            color: #4B5563;
        }

        /* Main Container */
        .main-container {
            position: relative;
            z-index: 10;
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            gap: 1rem;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 1rem;
            position: absolute;
            top: 1rem;
            z-index: 20;
            width: 100%;
            pointer-events: none;
        }

        .header h1 {
            font-size: 1.875rem;
            margin-bottom: 0.5rem;
            font-weight: bold;
            display: inline-block;
            color: #FF9E99;
        }

        .header .subtitle {
            font-size: 0.875rem;
            color: #4B5563;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.6);
            padding: 0.25rem 1.5rem;
            border-radius: 9999px;
            display: inline-block;
        }

        /* Wheel Container */
        .wheel-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            transform: scale(0.9);
            transition: transform 0.5s ease;
            margin-top: 5rem;
            margin-bottom: 2rem;
        }

        .wheel-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            aspect-ratio: 1;
            margin-bottom: 1rem;
        }

        .wheel-canvas {
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            width: 100%;
            height: 100%;
            background: white;
        }

        /* Pointer */
        .pointer {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) translateY(-12px);
            z-index: 20;
            width: 56px;
            height: 56px;
        }

        /* Center Gift */
        .center-gift {
            position: absolute;
            inset: 0;
            margin: auto;
            width: 96px;
            height: 96px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 4px solid #FFB7B2;
            z-index: 10;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 25px rgba(255, 183, 178, 0.7), 0 0 50px rgba(255, 183, 178, 0.4), 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .center-gift:hover {
            transform: scale(1.1);
        }

        .center-gift:active {
            transform: scale(0.95);
        }

        /* Winner Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.9);
            padding: 2rem;
            border-radius: 3rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            text-align: center;
            transform: scale(0.5);
            transition: transform 0.3s ease;
            border: 8px solid #FFB7B2;
            max-width: 24rem;
            width: 100%;
            margin: 1rem;
            position: relative;
            overflow: hidden;
        }

        .modal-content::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, white, #FFF0F0);
            z-index: -1;
        }

        .modal-emoji {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #FF9E99;
            margin-bottom: 0.5rem;
        }

        .modal-number {
            font-size: 4.5rem;
            font-weight: bold;
            color: #4A4A4A;
            margin: 1rem 0;
            font-family: monospace;
        }

        .modal-subtitle {
            color: #6B7280;
            margin-bottom: 2rem;
        }

        /* History Item */
        .history-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 0.75rem;
            border-radius: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #FFB7B2;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .history-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4A4A4A;
        }

        .history-index {
            font-size: 0.875rem;
            color: #9CA3AF;
        }

        .history-time {
            font-size: 0.75rem;
            color: #9CA3AF;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding-right: 0.25rem;
        }

        .history-empty {
            text-align: center;
            color: #9CA3AF;
            padding: 1rem;
            font-size: 0.875rem;
        }

        /* Responsive */
        @media (min-width: 768px) {
            .header h1 {
                font-size: 3.75rem;
            }

            .header .subtitle {
                font-size: 1.125rem;
            }

            .wheel-wrapper {
                transform: scale(1);
                margin-top: 0;
            }

            .wheel-container {
                max-width: 650px;
            }

            .wheel-canvas {
                border-width: 8px;
            }

            .pointer {
                width: 80px;
                height: 80px;
                transform: translateX(-50%) translateY(-24px);
            }

            .center-gift {
                width: 144px;
                height: 144px;
            }

            .modal-content {
                padding: 3rem;
            }

            .modal-emoji {
                font-size: 6rem;
            }

            .modal-title {
                font-size: 1.875rem;
            }

            .modal-number {
                font-size: 6rem;
            }

            .shape {
                font-size: 2rem;
            }
        }
    </style>
</head>

<body>
    <div id="shapes-container" class="fixed inset-0 pointer-events-none overflow-hidden"></div>

    <div class="main-container">
        <header class="header">
            <h1 class="text-glow">LuckySpin 2025</h1>
            <br>
            <p class="subtitle pointer-events-auto">üéÅ ‡∏à‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà üíñ</p>
        </header>

        <!-- Top Right Icon Buttons -->
        <div class="fixed" style="top: 1rem; right: 1rem; z-index: 50; display: flex; gap: 0.5rem;">
            <button id="settingsIconBtn" class="icon-btn border-2 border-pink" title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç">
                <span class="text-xl">‚öôÔ∏è</span>
            </button>
            <button id="historyIconBtn" class="icon-btn border-2 border-purple" title="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥">
                <span class="text-xl">üìú</span>
            </button>
        </div>

        <!-- Settings Popup Panel -->
        <div id="settingsPanel" class="popup-panel glass-panel">
            <div class="p-4">
                <div class="flex justify-between items-center mb-4">
                    <span class="flex items-center gap-2 font-bold text-pink"><span class="text-xl">‚öôÔ∏è</span>
                        ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</span>
                    <button id="closeSettingsBtn" class="close-btn">&times;</button>
                </div>
                <div class="mb-4 p-3"
                    style="background: rgba(255,255,255,0.5); border-radius: 0.75rem; border: 1px solid #FFB7B2;">
                    <label class="text-xs text-gray-500 mb-2" style="display: block;">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç 1 ‡∏ñ‡∏∂‡∏á...</label>
                    <div class="flex gap-2">
                        <input type="number" id="quickCount" class="input-field" placeholder="20" value="20" min="1"
                            max="100">
                        <button id="generateBtn" class="btn btn-pink">Go</button>
                    </div>
                </div>
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-500">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏á (<span id="numberCount">0</span>)</span>
                    <button id="resetBtn" class="link-btn">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
                </div>
                <textarea id="numbersInput" class="textarea-field" placeholder="1&#10;2&#10;3..."></textarea>
                <button id="updateBtn" class="btn btn-purple btn-full mt-3">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ß‡∏á‡∏•‡πâ‡∏≠</button>
            </div>
        </div>

        <!-- History Popup Panel -->
        <div id="historyPanel" class="popup-panel glass-panel">
            <div class="p-4">
                <div class="flex justify-between items-center mb-4">
                    <span class="flex items-center gap-2 font-bold text-purple"><span class="text-xl">üìú</span> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                        (<span id="historyCount">0</span>)</span>
                    <button id="closeHistoryBtn" class="close-btn">&times;</button>
                </div>
                <div class="flex justify-end mb-2">
                    <button id="clearHistoryBtn" class="link-btn">‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
                </div>
                <div class="history-list" id="historyList">
                    <div class="history-empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>
                </div>
            </div>
        </div>

        <!-- Wheel -->
        <div class="wheel-wrapper">
            <div class="wheel-container">
                <div class="pointer">
                    <svg viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M30 60L10 10H50L30 60Z" fill="#FFFFD1" stroke="#FFB7B2" stroke-width="3" />
                        <circle cx="30" cy="15" r="5" fill="#FFF" />
                    </svg>
                </div>
                <canvas id="wheelCanvas" width="600" height="600" class="wheel-canvas"></canvas>
                <div id="centerGift" class="center-gift animate-pulse-soft" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏∏‡∏ô">
                    <svg width="60%" height="60%" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="8" y="28" width="48" height="32" rx="4" fill="#FFB7B2" />
                        <rect x="4" y="20" width="56" height="12" rx="3" fill="#FF9E99" />
                        <rect x="28" y="20" width="8" height="40" fill="#FFDAC1" />
                        <rect x="4" y="24" width="56" height="6" fill="#FFDAC1" />
                        <ellipse cx="24" cy="16" rx="8" ry="6" fill="#C7CEEA" />
                        <ellipse cx="40" cy="16" rx="8" ry="6" fill="#C7CEEA" />
                        <circle cx="32" cy="18" r="5" fill="#B5EAD7" />
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Winner Modal -->
    <div id="winnerModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-emoji animate-bounce">üéâ</div>
            <h2 class="modal-title">‡πÄ‡∏•‡∏Ç‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡∏Ñ‡∏∑‡∏≠üéâ</h2>
            <div id="modalResultNumber" class="modal-number">--</div>
            <p class="modal-subtitle">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡πâ‡∏≤‡∏ö! üéÅ</p>
            <button id="closeModalBtn" class="btn btn-mint btn-full">‡∏ï‡∏Å‡∏•‡∏á ‚ú®</button>
        </div>
    </div>

    <canvas id="fireworksCanvas" class="fixed inset-0 pointer-events-none z-50"></canvas>

    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('‚úÖ SW registered'))
                    .catch(err => console.log('‚ùå SW failed:', err));
            });
        }

        const defaultData = { numbers: Array.from({ length: 20 }, (_, i) => (i + 1).toString()), history: [] };
        let data = loadData();
        let isSpinning = false;
        let currentAngle = 0;
        let velocity = 0;
        let friction = 0.985;
        let animationId = null;
        let glowAnimationId = null;
        let lastGlowTime = 0;
        const GLOW_INTERVAL = 33; // ~30fps instead of 60fps

        const canvas = document.getElementById("wheelCanvas");
        const ctx = canvas.getContext("2d");
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = canvas.width / 2 - 20;

        const glowColors = ["#FFD700", "#FF69B4", "#00FFFF", "#FF6347", "#7FFF00", "#FF1493", "#00FF7F"];

        function init() {
            syncUI();
            drawWheel();
            updateHistoryUI();
            createFloatingShapes();
            startGlowAnimation();

            setTimeout(() => {
                const header = document.querySelector('.header');
                if (header) header.classList.add('fade-out');
            }, 5000);

            document.getElementById("centerGift").addEventListener("click", startSpin);
            document.getElementById("generateBtn").addEventListener("click", generateNumbers);
            document.getElementById("updateBtn").addEventListener("click", updateNumbersFromInput);
            document.getElementById("resetBtn").addEventListener("click", () => {
                if (confirm("‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô 1-20?")) {
                    data.numbers = shuffleArray(Array.from({ length: 20 }, (_, i) => (i + 1).toString()));
                    saveData(); syncUI(); drawWheel();
                }
            });
            document.getElementById("clearHistoryBtn").addEventListener("click", () => {
                if (confirm("‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥?")) { data.history = []; saveData(); updateHistoryUI(); }
            });
            document.getElementById("closeModalBtn").addEventListener("click", closeModal);

            document.getElementById("settingsIconBtn").addEventListener("click", () => {
                document.getElementById("settingsPanel").classList.toggle("show");
                document.getElementById("historyPanel").classList.remove("show");
            });
            document.getElementById("historyIconBtn").addEventListener("click", () => {
                document.getElementById("historyPanel").classList.toggle("show");
                document.getElementById("settingsPanel").classList.remove("show");
            });
            document.getElementById("closeSettingsBtn").addEventListener("click", () => {
                document.getElementById("settingsPanel").classList.remove("show");
            });
            document.getElementById("closeHistoryBtn").addEventListener("click", () => {
                document.getElementById("historyPanel").classList.remove("show");
            });
        }

        // OPTIMIZED: 30fps glow animation
        function startGlowAnimation() {
            function animateGlow(timestamp) {
                if (!isSpinning && timestamp - lastGlowTime >= GLOW_INTERVAL) {
                    drawWheel();
                    lastGlowTime = timestamp;
                }
                glowAnimationId = requestAnimationFrame(animateGlow);
            }
            glowAnimationId = requestAnimationFrame(animateGlow);
        }

        // OPTIMIZED: Reduced snowflakes from 30 to 15
        function createFloatingShapes() {
            const container = document.getElementById("shapes-container");
            const shapes = ['‚ùÖ', '‚ùÜ'];
            for (let i = 0; i < 15; i++) {
                const el = document.createElement("div");
                el.className = "shape";
                el.textContent = shapes[Math.floor(Math.random() * shapes.length)];
                el.style.left = Math.random() * 100 + "vw";
                el.style.top = -10 + "vh";
                el.style.animationDuration = (Math.random() * 5 + 5) + "s";
                el.style.animationDelay = (Math.random() * 10) + "s";
                container.appendChild(el);
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function generateNumbers() {
            const count = parseInt(document.getElementById("quickCount").value) || 20;
            if (count < 1) return;
            if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç 1 ‡∏ñ‡∏∂‡∏á ${count} ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                data.numbers = shuffleArray(Array.from({ length: count }, (_, i) => (i + 1).toString()));
                saveData(); syncUI(); drawWheel();
            }
        }

        function startSpin() {
            if (isSpinning) return;
            if (data.numbers.length === 0) { alert("‚ùå ‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß!"); return; }

            isSpinning = true;
            document.getElementById("centerGift").classList.add("hidden");
            document.getElementById("settingsPanel").classList.remove("show");
            document.getElementById("historyPanel").classList.remove("show");

            velocity = Math.random() * 25 + 20;
            friction = 0.980 + (Math.random() * 0.009);
            animate();
        }

        function animate() {
            velocity *= friction;
            currentAngle += velocity;
            if (currentAngle >= 360) currentAngle -= 360;
            drawWheel();
            if (velocity < 0.05) stopSpin();
            else animationId = requestAnimationFrame(animate);
        }

        function stopSpin() {
            cancelAnimationFrame(animationId);
            isSpinning = false;

            const segmentAngle = 360 / data.numbers.length;
            const winningIndex = Math.floor(((360 - currentAngle + 270) % 360) / segmentAngle) % data.numbers.length;
            const winningNumber = data.numbers[winningIndex];

            setTimeout(() => handleWin(winningNumber, winningIndex), 500);
        }

        function handleWin(number, index) {
            launchFireworks();
            const winSound = new Audio("https://actions.google.com/sounds/v1/crowds/battle_crowd_celebrate_stutter.ogg");
            winSound.volume = 0.6;
            winSound.play().catch(() => { });

            const modal = document.getElementById("winnerModal");
            const modalContent = modal.querySelector(".modal-content");
            document.getElementById("modalResultNumber").textContent = number;
            modal.classList.remove("hidden");
            void modal.offsetWidth;
            modal.style.opacity = "1";
            modalContent.style.transform = "scale(1)";

            data.history.unshift({ number, timestamp: new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' }) });
            data.numbers.splice(index, 1);
            currentAngle = 0;
            saveData(); updateHistoryUI(); syncUI(); drawWheel();
        }

        function closeModal() {
            const modal = document.getElementById("winnerModal");
            const modalContent = modal.querySelector(".modal-content");
            modal.style.opacity = "0";
            modalContent.style.transform = "scale(0.5)";

            setTimeout(() => {
                modal.classList.add("hidden");
                document.getElementById("centerGift").classList.remove("hidden");
            }, 300);
        }

        function drawWheel() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const len = data.numbers.length;
            if (len === 0) return;

            const arc = (Math.PI * 2) / len;
            const time = Date.now() / 150;

            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(currentAngle * Math.PI / 180);

            for (let i = 0; i < len; i++) {
                const angle = i * arc;
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.arc(0, 0, radius, angle, angle + arc);
                ctx.lineTo(0, 0);

                const colors = [["#FFB7B2", "#FFDAC1"], ["#B5EAD7", "#E2F0CB"], ["#C7CEEA", "#E0BBE4"], ["#FFDAC1", "#FF9AA2"]];
                const colorPair = colors[i % colors.length];
                const gradient = ctx.createLinearGradient(0, 0, radius, 0);
                gradient.addColorStop(0, colorPair[0]);
                gradient.addColorStop(1, colorPair[1]);

                ctx.fillStyle = gradient;
                ctx.fill();
                ctx.strokeStyle = "#FFF";
                ctx.lineWidth = 4;
                ctx.stroke();

                ctx.save();
                ctx.rotate(angle + arc / 2);
                ctx.textAlign = "right";

                const glowIntensity = Math.sin(time + i * 0.7) * 0.5 + 0.5;
                const colorIndex = Math.floor((time / 2 + i) % glowColors.length);

                ctx.shadowColor = glowColors[colorIndex];
                ctx.shadowBlur = 10 + glowIntensity * 25;
                ctx.fillStyle = "#FFF";
                ctx.font = len > 50 ? "bold 14px Mali" : "bold 28px Mali";
                ctx.fillText(data.numbers[i], radius - 20, 8);

                ctx.shadowColor = "#FFFFFF";
                ctx.shadowBlur = 5 + glowIntensity * 15;
                ctx.fillText(data.numbers[i], radius - 20, 8);

                ctx.shadowBlur = 0;
                ctx.restore();
            }
            ctx.restore();

            ctx.save();
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.clip();
            const glassGradient = ctx.createLinearGradient(centerX - radius, centerY - radius, centerX + radius, centerY + radius);
            glassGradient.addColorStop(0, "rgba(255,255,255,0.4)");
            glassGradient.addColorStop(0.5, "rgba(255,255,255,0)");
            glassGradient.addColorStop(1, "rgba(255,255,255,0.1)");
            ctx.fillStyle = glassGradient;
            ctx.fill();
            ctx.restore();

            ctx.beginPath();
            ctx.arc(centerX, centerY, 40, 0, Math.PI * 2);
            ctx.fillStyle = "#FFF";
            ctx.fill();
            const centerGrad = ctx.createRadialGradient(centerX, centerY, 10, centerX, centerY, 35);
            centerGrad.addColorStop(0, "#FFF");
            centerGrad.addColorStop(1, "#FFB7B2");
            ctx.beginPath();
            ctx.arc(centerX, centerY, 35, 0, Math.PI * 2);
            ctx.fillStyle = centerGrad;
            ctx.fill();
            ctx.strokeStyle = "#FFF";
            ctx.lineWidth = 4;
            ctx.stroke();
        }

        function loadData() {
            const saved = localStorage.getItem("pastelLuckyDraw2025");
            if (saved) return JSON.parse(saved);
            return { ...defaultData };
        }

        function saveData() { localStorage.setItem("pastelLuckyDraw2025", JSON.stringify(data)); }
        function syncUI() {
            document.getElementById("numbersInput").value = data.numbers.join("\n");
            document.getElementById("numberCount").textContent = data.numbers.length;
        }

        function updateNumbersFromInput() {
            data.numbers = document.getElementById("numbersInput").value.split("\n").map(s => s.trim()).filter(s => s);
            saveData(); syncUI(); drawWheel();
        }

        function updateHistoryUI() {
            const list = document.getElementById("historyList");
            list.innerHTML = "";
            document.getElementById("historyCount").textContent = data.history.length;
            if (data.history.length === 0) {
                list.innerHTML = '<div class="history-empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>';
                return;
            }
            data.history.forEach((h, i) => {
                const item = document.createElement("div");
                item.className = "history-item";
                item.innerHTML = `<div class="flex items-center gap-3"><span class="history-index">#${data.history.length - i}</span><span class="history-number">${h.number}</span></div><div class="history-time">${h.timestamp}</div>`;
                list.appendChild(item);
            });
        }

        const fwCanvas = document.getElementById("fireworksCanvas");
        const fwCtx = fwCanvas.getContext("2d");
        let particles = [];

        function resizeFireworksCanvas() { fwCanvas.width = window.innerWidth; fwCanvas.height = window.innerHeight; }
        window.addEventListener('resize', resizeFireworksCanvas);
        resizeFireworksCanvas();

        function launchFireworks() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => createExplosion(Math.random() * fwCanvas.width, Math.random() * fwCanvas.height * 0.6), i * 300);
            }
            animateFireworks();
        }

        function createExplosion(x, y) {
            const colors = ["#FFB7B2", "#B5EAD7", "#C7CEEA", "#FFDAC1", "#FFF"];
            for (let i = 0; i < 50; i++) {
                particles.push({ x, y, vx: (Math.random() - 0.5) * 10, vy: (Math.random() - 0.5) * 10, alpha: 1, color: colors[Math.floor(Math.random() * colors.length)], size: Math.random() * 4 + 2 });
            }
        }

        function animateFireworks() {
            if (particles.length === 0) return;
            fwCtx.clearRect(0, 0, fwCanvas.width, fwCanvas.height);
            particles = particles.filter(p => {
                p.x += p.vx; p.y += p.vy; p.vy += 0.1; p.alpha -= 0.01;
                fwCtx.globalAlpha = p.alpha;
                fwCtx.fillStyle = p.color;
                fwCtx.beginPath();
                fwCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                fwCtx.fill();
                return p.alpha > 0;
            });
            requestAnimationFrame(animateFireworks);
        }

        init();
    </script>
</body>

</html>