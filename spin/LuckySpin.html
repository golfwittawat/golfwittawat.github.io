<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FF9E99">
    <meta name="description" content="‡∏ß‡∏á‡∏•‡πâ‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏à‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="LuckySpin">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.svg">
    <title>üéÅ LuckySpin 2025 üéâ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        .glass-panel {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(12px);
            border: 2px solid #FFF;
            box-shadow: 0 8px 32px 0 rgba(181, 234, 215, 0.4);
            border-radius: 24px;
            transition: all 0.3s ease;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #FFB7B2;
            border-radius: 4px;
        }

        .pastel-bg {
            background: linear-gradient(135deg, #FFDAC1 0%, #FFB7B2 25%, #E2F0CB 50%, #B5EAD7 75%, #C7CEEA 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .shape {
            position: absolute;
            filter: blur(1px);
            z-index: 0;
            animation: fall linear infinite;
            opacity: 0.8;
            color: #FFF;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
            pointer-events: none;
        }

        @keyframes fall {
            0% {
                transform: translateY(-10vh) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.8;
            }

            100% {
                transform: translateY(110vh) rotate(360deg);
                opacity: 0.4;
            }
        }

        details>summary {
            list-style: none;
            cursor: pointer;
        }

        details>summary::-webkit-details-marker {
            display: none;
        }

        .fade-out {
            opacity: 0 !important;
            pointer-events: none;
            transition: opacity 1s ease-out;
        }

        @keyframes pulse-soft {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 183, 178, 0.7);
            }

            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(255, 183, 178, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 183, 178, 0);
            }
        }

        .animate-pulse-soft {
            animation: pulse-soft 2s infinite;
        }

        .text-glow {
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8), 0 0 10px rgba(255, 183, 178, 0.5);
        }

        .popup-panel {
            position: fixed;
            top: 70px;
            right: 16px;
            width: 320px;
            max-width: calc(100vw - 32px);
            z-index: 45;
            transform: translateX(120%);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .popup-panel.show {
            transform: translateX(0);
            opacity: 1;
        }
    </style>
</head>

<body
    class="pastel-bg text-gray-700 min-h-screen flex flex-col items-center overflow-y-auto overflow-x-hidden relative">

    <div id="shapes-container" class="fixed inset-0 pointer-events-none overflow-hidden"></div>

    <div class="relative z-10 w-full min-h-screen flex flex-col items-center justify-center p-4 gap-4">

        <header class="text-center mb-4 absolute top-4 md:top-8 z-20 w-full pointer-events-none">
            <h1
                class="text-3xl md:text-6xl mb-2 font-bold drop-shadow-sm pointer-events-auto inline-block text-glow text-[#FF9E99]">
                LuckySpin 2025
            </h1>
            <br>
            <p
                class="text-sm md:text-lg text-gray-600 tracking-widest uppercase font-bold bg-white/60 px-6 py-1 rounded-full inline-block shadow-sm pointer-events-auto">
                üéÅ ‡∏à‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà üíñ</p>
        </header>

        <!-- Top Right Icon Buttons -->
        <div class="fixed top-4 right-4 z-50 flex gap-2">
            <button id="settingsIconBtn"
                class="w-12 h-12 bg-white/90 backdrop-blur-sm rounded-full shadow-lg flex items-center justify-center border-2 border-[#FFB7B2] cursor-pointer hover:scale-110 hover:shadow-xl transition-all duration-300 active:scale-95"
                title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç">
                <span class="text-xl">‚öôÔ∏è</span>
            </button>
            <button id="historyIconBtn"
                class="w-12 h-12 bg-white/90 backdrop-blur-sm rounded-full shadow-lg flex items-center justify-center border-2 border-[#C7CEEA] cursor-pointer hover:scale-110 hover:shadow-xl transition-all duration-300 active:scale-95"
                title="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥">
                <span class="text-xl">üìú</span>
            </button>
        </div>

        <!-- Settings Popup Panel -->
        <div id="settingsPanel" class="popup-panel glass-panel">
            <div class="p-4">
                <div class="flex justify-between items-center mb-4">
                    <span class="flex items-center gap-2 font-bold text-[#FF9E99]"><span class="text-xl">‚öôÔ∏è</span>
                        ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</span>
                    <button id="closeSettingsBtn" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
                </div>
                <div class="mb-4 p-3 bg-white/50 rounded-xl border border-[#FFB7B2]">
                    <label class="text-xs text-gray-500 mb-1 block">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç 1 ‡∏ñ‡∏∂‡∏á...</label>
                    <div class="flex gap-2">
                        <input type="number" id="quickCount"
                            class="w-full bg-white border border-[#FFB7B2] rounded-lg px-3 py-2 text-center focus:outline-none focus:ring-2 focus:ring-[#FFB7B2] font-bold text-gray-600"
                            placeholder="20" value="20" min="1" max="100">
                        <button id="generateBtn"
                            class="bg-[#FFB7B2] text-white px-3 rounded-lg hover:bg-[#FF9E99] active:scale-95 transition-transform">Go</button>
                    </div>
                </div>
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-500">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏á (<span id="numberCount">0</span>)</span>
                    <button id="resetBtn" class="text-xs text-red-400 hover:text-red-500 underline">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
                </div>
                <textarea id="numbersInput"
                    class="w-full h-32 bg-white border border-[#C7CEEA] rounded-xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#C7CEEA] resize-none font-mono text-gray-600"
                    placeholder="1&#10;2&#10;3..."></textarea>
                <button id="updateBtn"
                    class="mt-3 w-full py-2 bg-[#C7CEEA] hover:bg-[#B5B9E8] rounded-xl text-sm transition-colors text-white font-bold shadow-sm active:scale-95">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ß‡∏á‡∏•‡πâ‡∏≠</button>
            </div>
        </div>

        <!-- History Popup Panel -->
        <div id="historyPanel" class="popup-panel glass-panel">
            <div class="p-4">
                <div class="flex justify-between items-center mb-4">
                    <span class="flex items-center gap-2 font-bold text-[#C7CEEA]"><span class="text-xl">üìú</span>
                        ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (<span id="historyCount">0</span>)</span>
                    <button id="closeHistoryBtn" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
                </div>
                <div class="flex justify-end mb-2">
                    <button id="clearHistoryBtn"
                        class="text-xs text-red-400 hover:text-red-500 underline">‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
                </div>
                <div class="overflow-y-auto max-h-[300px] space-y-2 pr-1" id="historyList">
                    <div class="text-center text-gray-400 py-4 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>
                </div>
            </div>
        </div>

        <!-- Center Panel: Wheel -->
        <div
            class="flex flex-col items-center justify-center w-full h-full transform scale-90 md:scale-100 lg:scale-100 xl:scale-105 transition-transform duration-500 mt-20 lg:mt-0 mb-8 lg:mb-0">
            <div class="relative w-full max-w-[400px] md:max-w-[650px] aspect-square mb-4">
                <!-- Pointer -->
                <div
                    class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-3 md:-translate-y-6 z-20 filter drop-shadow-md">
                    <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg"
                        class="w-14 h-14 md:w-20 md:h-20">
                        <path d="M30 60L10 10H50L30 60Z" fill="#FFFFD1" stroke="#FFB7B2" stroke-width="3" />
                        <circle cx="30" cy="15" r="5" fill="#FFF" />
                    </svg>
                </div>

                <!-- Wheel Canvas -->
                <canvas id="wheelCanvas" width="600" height="600"
                    class="rounded-full border-4 md:border-8 border-white shadow-2xl transition-transform duration-300 w-full h-full bg-white"></canvas>

                <!-- Center Logo (Click to Spin) -->
                <div id="centerGift"
                    class="absolute inset-0 m-auto w-24 h-24 md:w-36 md:h-36 bg-white rounded-full flex items-center justify-center border-4 border-[#FFB7B2] z-10 cursor-pointer hover:scale-110 transition-all duration-300 active:scale-95 animate-pulse-soft"
                    style="box-shadow: 0 0 25px rgba(255, 183, 178, 0.7), 0 0 50px rgba(255, 183, 178, 0.4), 0 10px 30px rgba(0,0,0,0.2);"
                    title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏∏‡∏ô">
                    <svg width="60%" height="60%" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="8" y="28" width="48" height="32" rx="4" fill="#FFB7B2" />
                        <rect x="4" y="20" width="56" height="12" rx="3" fill="#FF9E99" />
                        <rect x="28" y="20" width="8" height="40" fill="#FFDAC1" />
                        <rect x="4" y="24" width="56" height="6" fill="#FFDAC1" />
                        <ellipse cx="24" cy="16" rx="8" ry="6" fill="#C7CEEA" />
                        <ellipse cx="40" cy="16" rx="8" ry="6" fill="#C7CEEA" />
                        <circle cx="32" cy="18" r="5" fill="#B5EAD7" />
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Winner Modal -->
    <div id="winnerModal"
        class="fixed inset-0 z-[100] flex items-center justify-center bg-black/40 backdrop-blur-sm hidden opacity-0 transition-opacity duration-300">
        <div
            class="bg-white/90 p-8 md:p-12 rounded-[3rem] shadow-2xl text-center transform scale-50 transition-transform duration-300 border-8 border-[#FFB7B2] max-w-sm md:max-w-lg w-full mx-4 relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-b from-white to-[#FFF0F0] -z-10"></div>
            <div class="text-6xl md:text-8xl mb-4 animate-bounce">üéâ</div>
            <h2 class="text-2xl md:text-3xl font-bold text-[#FF9E99] mb-2">‡πÄ‡∏•‡∏Ç‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡∏Ñ‡∏∑‡∏≠üéâ</h2>
            <div id="modalResultNumber"
                class="text-7xl md:text-9xl font-bold text-[#4A4A4A] drop-shadow-md my-4 font-mono">--</div>
            <p class="text-gray-500 mb-8">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡πâ‡∏≤‡∏ö! üéÅ</p>
            <button id="closeModalBtn"
                class="w-full py-3 bg-[#B5EAD7] hover:bg-[#9FDFC3] text-white text-xl font-bold rounded-2xl shadow-md active:scale-95 transition-all">‡∏ï‡∏Å‡∏•‡∏á
                ‚ú®</button>
        </div>
    </div>

    <canvas id="fireworksCanvas" class="fixed inset-0 pointer-events-none z-50"></canvas>

    <script>
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('‚úÖ Service Worker registered'))
                    .catch(err => console.log('‚ùå Service Worker failed:', err));
            });
        }

        const defaultData = { numbers: Array.from({ length: 20 }, (_, i) => (i + 1).toString()), history: [] };
        let data = loadData();
        let isSpinning = false;
        let currentAngle = 0;
        let velocity = 0;
        let friction = 0.985;
        let animationId = null;
        let glowAnimationId = null;

        const canvas = document.getElementById("wheelCanvas");
        const ctx = canvas.getContext("2d");
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = canvas.width / 2 - 20;

        const glowColors = ["#FFD700", "#FF69B4", "#00FFFF", "#FF6347", "#7FFF00", "#FF1493", "#00FF7F"];

        function init() {
            syncUI();
            drawWheel();
            updateHistoryUI();
            createFloatingShapes();
            startGlowAnimation();

            setTimeout(() => {
                const header = document.querySelector('header');
                if (header) header.classList.add('fade-out');
            }, 5000);

            document.getElementById("centerGift").addEventListener("click", startSpin);
            document.getElementById("generateBtn").addEventListener("click", generateNumbers);
            document.getElementById("updateBtn").addEventListener("click", updateNumbersFromInput);
            document.getElementById("resetBtn").addEventListener("click", () => {
                if (confirm("‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô 1-20?")) {
                    data.numbers = shuffleArray(Array.from({ length: 20 }, (_, i) => (i + 1).toString()));
                    saveData(); syncUI(); drawWheel();
                }
            });
            document.getElementById("clearHistoryBtn").addEventListener("click", () => {
                if (confirm("‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥?")) { data.history = []; saveData(); updateHistoryUI(); }
            });
            document.getElementById("closeModalBtn").addEventListener("click", closeModal);

            document.getElementById("settingsIconBtn").addEventListener("click", () => {
                document.getElementById("settingsPanel").classList.toggle("show");
                document.getElementById("historyPanel").classList.remove("show");
            });
            document.getElementById("historyIconBtn").addEventListener("click", () => {
                document.getElementById("historyPanel").classList.toggle("show");
                document.getElementById("settingsPanel").classList.remove("show");
            });
            document.getElementById("closeSettingsBtn").addEventListener("click", () => {
                document.getElementById("settingsPanel").classList.remove("show");
            });
            document.getElementById("closeHistoryBtn").addEventListener("click", () => {
                document.getElementById("historyPanel").classList.remove("show");
            });
        }

        function startGlowAnimation() {
            function animateGlow() {
                if (!isSpinning) drawWheel();
                glowAnimationId = requestAnimationFrame(animateGlow);
            }
            animateGlow();
        }

        function createFloatingShapes() {
            const container = document.getElementById("shapes-container");
            const shapes = ['‚ùÖ', '‚ùÜ'];
            for (let i = 0; i < 30; i++) {
                const el = document.createElement("div");
                el.className = "shape text-2xl md:text-4xl";
                el.textContent = shapes[Math.floor(Math.random() * shapes.length)];
                el.style.left = Math.random() * 100 + "vw";
                el.style.top = -10 + "vh";
                el.style.animationDuration = (Math.random() * 5 + 5) + "s";
                el.style.animationDelay = (Math.random() * 10) + "s";
                container.appendChild(el);
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function generateNumbers() {
            const count = parseInt(document.getElementById("quickCount").value) || 20;
            if (count < 1) return;
            if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç 1 ‡∏ñ‡∏∂‡∏á ${count} ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                data.numbers = shuffleArray(Array.from({ length: count }, (_, i) => (i + 1).toString()));
                saveData(); syncUI(); drawWheel();
            }
        }

        function startSpin() {
            if (isSpinning) return;
            if (data.numbers.length === 0) { alert("‚ùå ‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß!"); return; }

            isSpinning = true;
            document.getElementById("centerGift").classList.add("hidden");
            document.getElementById("settingsPanel").classList.remove("show");
            document.getElementById("historyPanel").classList.remove("show");

            velocity = Math.random() * 25 + 20;
            friction = 0.980 + (Math.random() * 0.009);
            animate();
        }

        function animate() {
            velocity *= friction;
            currentAngle += velocity;
            if (currentAngle >= 360) currentAngle -= 360;
            drawWheel();
            if (velocity < 0.05) stopSpin();
            else animationId = requestAnimationFrame(animate);
        }

        function stopSpin() {
            cancelAnimationFrame(animationId);
            isSpinning = false;

            const segmentAngle = 360 / data.numbers.length;
            const winningIndex = Math.floor(((360 - currentAngle + 270) % 360) / segmentAngle) % data.numbers.length;
            const winningNumber = data.numbers[winningIndex];

            setTimeout(() => handleWin(winningNumber, winningIndex), 500);
        }

        function handleWin(number, index) {
            launchFireworks();
            const winSound = new Audio("https://actions.google.com/sounds/v1/crowds/battle_crowd_celebrate_stutter.ogg");
            winSound.volume = 0.6;
            winSound.play().catch(() => { });

            const modal = document.getElementById("winnerModal");
            const modalContent = modal.querySelector("div");
            document.getElementById("modalResultNumber").textContent = number;
            modal.classList.remove("hidden");
            void modal.offsetWidth;
            modal.classList.remove("opacity-0");
            modalContent.classList.remove("scale-50");
            modalContent.classList.add("scale-100");

            data.history.unshift({ number, timestamp: new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' }) });
            data.numbers.splice(index, 1);
            currentAngle = 0;
            saveData(); updateHistoryUI(); syncUI(); drawWheel();
        }

        function closeModal() {
            const modal = document.getElementById("winnerModal");
            const modalContent = modal.querySelector("div");
            modal.classList.add("opacity-0");
            modalContent.classList.remove("scale-100");
            modalContent.classList.add("scale-50");

            setTimeout(() => {
                modal.classList.add("hidden");
                document.getElementById("centerGift").classList.remove("hidden");
            }, 300);
        }

        function drawWheel() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const len = data.numbers.length;
            if (len === 0) return;

            const arc = (Math.PI * 2) / len;
            const time = Date.now() / 150;

            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(currentAngle * Math.PI / 180);

            for (let i = 0; i < len; i++) {
                const angle = i * arc;
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.arc(0, 0, radius, angle, angle + arc);
                ctx.lineTo(0, 0);

                const colors = [["#FFB7B2", "#FFDAC1"], ["#B5EAD7", "#E2F0CB"], ["#C7CEEA", "#E0BBE4"], ["#FFDAC1", "#FF9AA2"]];
                const colorPair = colors[i % colors.length];
                const gradient = ctx.createLinearGradient(0, 0, radius, 0);
                gradient.addColorStop(0, colorPair[0]);
                gradient.addColorStop(1, colorPair[1]);

                ctx.fillStyle = gradient;
                ctx.fill();
                ctx.strokeStyle = "#FFF";
                ctx.lineWidth = 4;
                ctx.stroke();

                ctx.save();
                ctx.rotate(angle + arc / 2);
                ctx.textAlign = "right";

                const glowIntensity = Math.sin(time + i * 0.7) * 0.5 + 0.5;
                const colorIndex = Math.floor((time / 2 + i) % glowColors.length);

                ctx.shadowColor = glowColors[colorIndex];
                ctx.shadowBlur = 10 + glowIntensity * 25;
                ctx.fillStyle = "#FFF";
                ctx.font = len > 50 ? "bold 14px Mali" : "bold 28px Mali";
                ctx.fillText(data.numbers[i], radius - 20, 8);

                ctx.shadowColor = "#FFFFFF";
                ctx.shadowBlur = 5 + glowIntensity * 15;
                ctx.fillText(data.numbers[i], radius - 20, 8);

                ctx.shadowBlur = 0;
                ctx.strokeStyle = "rgba(0,0,0,0.3)";
                ctx.lineWidth = 1;
                ctx.strokeText(data.numbers[i], radius - 20, 8);

                ctx.restore();
            }
            ctx.restore();

            ctx.save();
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.clip();
            const glassGradient = ctx.createLinearGradient(centerX - radius, centerY - radius, centerX + radius, centerY + radius);
            glassGradient.addColorStop(0, "rgba(255,255,255,0.4)");
            glassGradient.addColorStop(0.5, "rgba(255,255,255,0)");
            glassGradient.addColorStop(1, "rgba(255,255,255,0.1)");
            ctx.fillStyle = glassGradient;
            ctx.fill();
            ctx.restore();

            ctx.beginPath();
            ctx.arc(centerX, centerY, 40, 0, Math.PI * 2);
            ctx.fillStyle = "#FFF";
            ctx.fill();
            const centerGrad = ctx.createRadialGradient(centerX, centerY, 10, centerX, centerY, 35);
            centerGrad.addColorStop(0, "#FFF");
            centerGrad.addColorStop(1, "#FFB7B2");
            ctx.beginPath();
            ctx.arc(centerX, centerY, 35, 0, Math.PI * 2);
            ctx.fillStyle = centerGrad;
            ctx.fill();
            ctx.strokeStyle = "#FFF";
            ctx.lineWidth = 4;
            ctx.stroke();
        }

        function loadData() {
            const saved = localStorage.getItem("pastelLuckyDraw2025");
            if (saved) return JSON.parse(saved);
            return { ...defaultData };
        }

        function saveData() { localStorage.setItem("pastelLuckyDraw2025", JSON.stringify(data)); }
        function syncUI() {
            document.getElementById("numbersInput").value = data.numbers.join("\n");
            document.getElementById("numberCount").textContent = data.numbers.length;
        }

        function updateNumbersFromInput() {
            data.numbers = document.getElementById("numbersInput").value.split("\n").map(s => s.trim()).filter(s => s);
            saveData(); syncUI(); drawWheel();
        }

        function updateHistoryUI() {
            const list = document.getElementById("historyList");
            list.innerHTML = "";
            document.getElementById("historyCount").textContent = data.history.length;
            if (data.history.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-400 py-4 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>';
                return;
            }
            data.history.forEach((h, i) => {
                const item = document.createElement("div");
                item.className = "bg-white bg-opacity-80 p-3 rounded-xl flex justify-between items-center border-l-4 border-[#FFB7B2] shadow-sm";
                item.innerHTML = `<div class="flex items-center gap-3"><span class="text-gray-400 text-sm">#${data.history.length - i}</span><span class="text-2xl font-bold text-[#4A4A4A]">${h.number}</span></div><div class="text-xs text-gray-400">${h.timestamp}</div>`;
                list.appendChild(item);
            });
        }

        const fwCanvas = document.getElementById("fireworksCanvas");
        const fwCtx = fwCanvas.getContext("2d");
        let particles = [];

        function resizeFireworksCanvas() { fwCanvas.width = window.innerWidth; fwCanvas.height = window.innerHeight; }
        window.addEventListener('resize', resizeFireworksCanvas);
        resizeFireworksCanvas();

        function launchFireworks() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => createExplosion(Math.random() * fwCanvas.width, Math.random() * fwCanvas.height * 0.6), i * 300);
            }
            animateFireworks();
        }

        function createExplosion(x, y) {
            const colors = ["#FFB7B2", "#B5EAD7", "#C7CEEA", "#FFDAC1", "#FFF"];
            for (let i = 0; i < 50; i++) {
                particles.push({ x, y, vx: (Math.random() - 0.5) * 10, vy: (Math.random() - 0.5) * 10, alpha: 1, color: colors[Math.floor(Math.random() * colors.length)], size: Math.random() * 4 + 2 });
            }
        }

        function animateFireworks() {
            if (particles.length === 0) return;
            fwCtx.clearRect(0, 0, fwCanvas.width, fwCanvas.height);
            particles = particles.filter(p => {
                p.x += p.vx; p.y += p.vy; p.vy += 0.1; p.alpha -= 0.01;
                fwCtx.globalAlpha = p.alpha;
                fwCtx.fillStyle = p.color;
                fwCtx.beginPath();
                fwCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                fwCtx.fill();
                return p.alpha > 0;
            });
            requestAnimationFrame(animateFireworks);
        }

        init();
    </script>
</body>

</html>